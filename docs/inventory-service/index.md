# Inventory Services

At the core of the e-voucher business is the digital PINs received from providers and securely transit to database systems a two way encryptions must took place currently the process , from providers to distributor and then from distributor to secure database system for customersâ€™ orders.

## Purchase Orders

The purchase process is standard process using common business practice:

' Axiom PO '   > 'Receive Goods from Provider' > 'Check quantities' > 'Store PINs'

ETW System will not change the process but the domain model is changes 

Purchase Order: Each unique PO will save its own items no SQL master/details is required with the advancement of
document object data model

A supplier is part of ERP business process at Axiom domain model 


## Digital PIN lifecycle 

<img src=./img/pins.png>

PINs moved using SFTP process from providers to Axiom system and then from SFTP drop files storage to PIN inventory services ready for customer orders. 

### Master Pool problem

The problem of current process is that it will allow one master pool for all orders , the next PIN status that is free for order will be send to customer POS/API , this type of process have many problems:

1. Master pool gives PIN to any order reached the system, leaves some important customers without stock
2. Large order may consumes stock , leave small customers without stock
3. We don't preserves stock in peek time like public holiday, when provider not ready to accept new purchase order
4. PIN history lost between may small and large customers.
5. We lost good cash-flow & margins when cash-customers or margins customers out of stock 


## The Solution, Stock Pools

When PINs arrives a good process must do the following:

1. Calculate existing pools quantities 
2. Distributor stock in all active pools based on human look at existing pool status as results of orders.
3. Ensure fair balance between our customers type A, B , C categories. 

<img src=./img/stockpools.png>

# Order Process change

To do that we need to change the way we process stock and save stock , the stock repository will hold master information called 'Master Stock' 

The total quantities of the master stock is = 'Old stock + New Stock' , the new ordering process will not use the master stock but will use the logical pool that is configured for the customer class , catagory A will consumes from Pool A , and so on.

A pre-defined manual or AI pool process is always working to balance the stock in each pool as configured by the admin , the resulting process. 

<img src=./img/pickpool.png>

# Domain Data 

Digital inventory is different from normal physical stock , the data is a check of codes 
That enable consumer to pay for airtime data, these are pre-paid code known as voucher PINs 
The data is generated by supplier or service provider like DU , Etisalat , the data is have normal PO process and then send via SFTP encrypted and signed
Axiom as distributor will receive data based on a greed process and store security in database.

## Purchase PO

PO is normal commerical supplier/re-seller process , the PO rasied to buy digital PINs , service provider approve and send the PINs to SFTP server,
we pick the PINs and process the PO closing process 

<img src=./img/po.png>

## PINs

PINs received to SFTP will have the following functional steps:

1. Receive email notifications manually by service provider 
2. User check the email and update the PO delivery note of received stock as claimed by service provider 
3. Read PO info from PO database as updated by PO user 
4. Read the PIN files by PIN serial & code , count the pins received 
5. When match found conform delivery note data , email trigger to PO user 
6. Send API to ERP system to close the PO 
7. Open PIN for sales from main inventory database.

# Domain Schema 

<img src=./img/inventory_schema.png>

1. [Suppplier](#Supplier)
2. [Purchase Order](#PurchaseOrder)
3. [Delivery Note](#DeliveryNote)
4. [Purchase Events](#PurchaseEvent)
5. [MasterStock](#MasterStock)
6. [Stock Pool](#StockPool)
7. [Shipping Event](#ShippingEvent)


# Supplier

Supplier doc will hold info about supplier, as we don't have above 10 suppliers its natrual to have NoSQL database
to store such data

```
{
	
	"SupplierId": 200100,
	"NameEn": "DU Emirates Telcom",
	"NameAr": "",
	"CreateAt": "1/1/2007",
	"UpdateAt": "",
	"CreateBy": "",
	"UpdateBy": "",
	"ApprovedBy": "",
	"ApproveDate": "",
	"Class": "Pin",
	"OEM": "Yes",
	"Exclusive": "Yes",
	"Payments": "Credit",
	"Days": 30,
	"Brands": [
		"Du Mobile",
		"Du Mobile Data"
	],
	"AgreementType": "Distributor",
	"StartDate": "",
	"ExpiryDate": "",
	"Renewal": "Auto",
	"AgreementPDF": "url",
	"Contacts": [
		{
			"Name": "",
			"Address": "",
			"Tel": "",
			"Mobile": "",
			"email": "",
			"Web": "",
			"Designations": "Manager"
		}
	]
}
```

# PurchaseOrder 

```
{

	"PO": 123123,
	"CreateAt": "",
	"UpdateAt": "",
	"CreateBy": "User.Name",
	"UpdateBy": "User.Name",
	"Supplier": "ProvideID",
	"BatchID": 1999,
	"BatchDate": "",
	"Desc": "Order PIN stock from du",
	"Items": [
		{
			"ProductID": 10002,
			"Desc": "Du 20",
			"Qty": 100,
			"Price": 19.9
		}
	]
}

```
# DeliveryNote

```
{
	"DeliveryID": 1233,
	"RefPO": 100,
	"CreatedAt": "",
	"UpdateAt": "",
	"CreatedBy": "",
	"UpdateBy": "",
	"Note": "",
	"Items": [
		{
			"ProductID": 10002,
			"Desc": "Du 20",
			"OrderedQty": 100,
			"RecviedQty": 100
		}
	]
}
```

# MasterStock 

```
{
	"id": 2334,
	"Supplierid":200100
	"ProductId": 1,
	"Total": 100,
	"Items": [
		{
			"Serial": 3.4343234234e+10,
			"Pin": "2323423",
			"ExpiryDate": "datetime",
			"status": "ready"
		}
		{
		 //100 items in the arrary			
		}
	]
}

```
# StockPool

```
{
	"PoolID": 100,
	"CreateAt": "",
	"UpdateAt": "",
	"CreateBy": "",
	"UpdateBy": "",
	"StartSerial": 1,
	"EndSerial": 5000,
	"Status": "active",
	"Total": 400,
	"QeueStatus": 0.1,
	"TotalSold": 10
}
```
# ShippingEvent

```
{
	"OrderID": 100,
	"CreateAt": "",
	"ItemType": "PIN,DTU,SMT",
	"ItemsSerial": [
		10000
	],
	"Events": [
		"Reserved",
		"Transit",
		"Shipped",
		"Delivered",
		"Blocked",
		"Claimed",
		"Resend",
		"Archived"
	]
}

```
